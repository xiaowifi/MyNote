## 前言
当前资料主要是通过微信读书书籍[android插件化开发指南](https://weread.qq.com/web/bookDetail/20a32d70715db31720ac689)
进行转换为理解。很多知识点会拆分到技术点的相关笔记中。
当前书籍涉及代码仓库为：[GitHub:BaoBaoJianqiang](https://github.com/BaoBaoJianqiang)

那么如何做到插件化。这就需要对整个apk文件有全面的理解。我们生成的apk其实是一个项目的压缩文件，包含字节码和资源两部分。
字节码主要是JAVA字节码，so 文件作为可执行程序所以不在字节码里面，在Android中他属于资源。同时还包含一些UI相关的图片什么的。

Android 系统作为Linux系统上的一个子进程。采用了JVM这种跨平台方案，那么我们和iOS就有了本质上的区别，iOS 写的是基于MAC OS可以直接运行的程序。
我们写的是Linux系统上运行的虚拟机在JVM或者ART规范上的程序，所以说，我们写JAVA代码并不是直接运行到Linux上的，而是在虚拟机上的。
这里就需要理解一个问题，JVM的执行JAVA的机制了，虚拟机将class字节码拿到然后转成指令，所以我们才有了class的加载机制，他运行的东西可以被替换和添加。

在art虚拟机上，类加载机制和JVM是不一样的。这个知识点模糊，抽时间补充。

正是因为他是文件，而且是使用时候加载。所以虚拟机模式下提供了天然的插件化的逻辑。Android 系统出于安全考虑，很多系统提供的服务都做了限制，比如4大组件没有注册就不能使用。
比如只是加载了apk 文件中的dex 和资源，比如apk 不解压而是每次运行读取apk 内容等等。而插件化是需要执行动态下发的业务代码，那么直接下发一个apk 则是最方便的策略。既然自己都是这么加载的，那么只需要对加载策略进行变更便可以达到插件化的诉求。
所以插件化不可避免的需要去hook系统源码同时每次APP启动都需要执行添加插件的逻辑。所以插件化的本质就是：“利用hook技术实现欺上瞒下，从而达到免安装运行的目的”
这就需要很多的动态代理相关的代码了。

### 如何面对Android P的限制
至于为什么会有这个，在反射和动态代理非常频繁出现的今天。系统API往往会随着功能的更新，然后去迭代API，但是反射相关的技术对于入参和class的锁定模式。会导致class变更后反射不可用
。同时系统也在做安全相关的处理，所以对于某些API提出了禁止调用或者可能出现变更的标记。@hide  
所以在一定程度对于系统源码进行hook 这一方向可能会存在一定程度上的兼容问题。

# 正文
## 预备知识
### 插件化技术的昨天，今天，明天
### Android 底层知识
#### binder

#### AIDL
#### AMS
#### 4大组件工作原理
#### PMS
#### APP 安装过程
#### ClassLoader以及双亲委托机制
### 反射
### 代理模式
### 对于startActivity 进行hook
## 解决方案
### 插件化技术的基本知识
### 资源初探
### 最简单的插件化解决方案
### activity的插件化解决方案
### service的插件化解决方案 
### broadcastReceiver的插件化解决方案
### contentProvider 的插件化解决放哪
### 基于静态代理的插件化解决方案：that框架
### 再谈资源
### 基于fragment的插件化框架 
## 相关技术 
### 降级
### 插件的混淆
### 增量更新
### so的插件化解决方案
### 对APP的打包流程进行hook 
### 插件化技术总结
## 附录
### 常用工具
